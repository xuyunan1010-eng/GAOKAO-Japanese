<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ—¥è¯­é«˜é¢‘è¯åˆ†ç±»æå– (æœ¬åœ°è¯åº“ç‰ˆ)</title>
    <style>
        body { font-family: "Hiragino Kaku Gothic ProN", "Microsoft YaHei", sans-serif; background: #f0f4f8; padding: 20px; color: #1e293b; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 25px; }
        .status { padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; background: #fff7ed; color: #c2410c; text-align: center; border: 1px solid #ffedd5; }
        .status.ready { background: #f0fdf4; color: #15803d; border-color: #bbf7d0; }
        
        /* ä¸‰æ å¸ƒå±€ */
        .columns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px; }
        .column { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; height: 600px; display: flex; flex-direction: column; }
        .column h3 { margin-top: 0; padding-bottom: 12px; border-bottom: 3px solid #3b82f6; font-size: 18px; color: #334155; display: flex; justify-content: space-between; }
        .word-list { overflow-y: auto; flex-grow: 1; }
        
        .word-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 5px; border-bottom: 1px solid #f1f5f9; }
        .word-item:hover { background: #f8fafc; }
        .word-text { font-weight: 600; color: #2563eb; font-size: 15px; }
        .word-count { background: #f1f5f9; color: #64748b; font-size: 11px; padding: 2px 7px; border-radius: 10px; }
        
        button { width: 100%; padding: 18px; background: #3b82f6; color: white; border: none; border-radius: 10px; font-size: 17px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { background: #2563eb; shadow: 0 4px 12px rgba(59,130,246,0.3); }
        button:disabled { background: #cbd5e1; cursor: not-allowed; }
        
        .badge { font-size: 12px; background: #3b82f6; color: white; padding: 2px 8px; border-radius: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>ğŸ‡¯ğŸ‡µ æ—¥è¯­çœŸé¢˜è¯é¢‘åˆ†æ (åˆ†ç±»ç‰ˆ)</h2>
    </div>

    <div id="status" class="status">æ­£åœ¨è¯»å–æœ¬åœ°å­—å…¸ (dict/)...</div>
    
    <input type="file" id="fileInput" accept=".docx" hidden>
    <button id="uploadBtn" disabled>ç­‰å¾…å¼•æ“å°±ç»ª...</button>

    <div class="columns">
        <div class="column">
            <h3><span>ğŸ”¹ åŠ¨è¯</span> <span id="verbCount" class="badge">0</span></h3>
            <div id="verbList" class="word-list"></div>
        </div>
        <div class="column">
            <h3><span>ğŸ”¸ åè¯</span> <span id="nounCount" class="badge">0</span></h3>
            <div id="nounList" class="word-list"></div>
        </div>
        <div class="column">
            <h3><span>ğŸŒ¿ å½¢å®¹/å‰¯è¯</span> <span id="adjCount" class="badge">0</span></h3>
            <div id="adjList" class="word-list"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.21/mammoth.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js"></script>

<script>
    const statusEl = document.getElementById('status');
    const uploadBtn = document.getElementById('uploadBtn');
    let tokenizer = null;

    // ä½¿ç”¨æœ¬åœ°ç›¸å¯¹è·¯å¾„åŠ è½½è¯åº“ (å³ä½  GitHub ä»“åº“é‡Œçš„ dict æ–‡ä»¶å¤¹)
    kuromoji.builder({ dicPath: "dict/" }).build((err, _tokenizer) => {
        if (err) {
            statusEl.textContent = "âŒ å­—å…¸åŠ è½½å¤±è´¥ï¼è¯·ç¡®ä¿ dict æ–‡ä»¶å¤¹åœ¨ index.html åŒçº§ç›®å½•ä¸‹";
            console.error(err);
            return;
        }
        tokenizer = _tokenizer;
        statusEl.textContent = "âœ… æœ¬åœ°å¼•æ“å·²å°±ç»ªï¼";
        statusEl.classList.add('ready');
        uploadBtn.disabled = false;
        uploadBtn.textContent = "é€‰æ‹© Word è¯•å·å¼€å§‹åˆ†æ";
    });

    uploadBtn.onclick = () => document.getElementById('fileInput').click();

    document.getElementById('fileInput').onchange = async (e) => {
        const file = e.target.files[0];
        if (!file || !tokenizer) return;

        statusEl.textContent = "âŒ› æ­£åœ¨è§£ææ–‡æ¡£å¹¶è¿˜åŸè¾ä¹¦å½¢...";
        
        try {
            const buffer = await file.arrayBuffer();
            const { value } = await mammoth.extractRawText({ arrayBuffer: buffer });
            
            const tokens = tokenizer.tokenize(value);
            // ç»†åˆ†è¯æ€§ç»Ÿè®¡
            const data = { 'å‹•è©': {}, 'åè©': {}, 'å½¢å®¹è©': {} };

            tokens.forEach(t => {
                // ç¡®å®šåˆ†ç±»ï¼šå°† å½¢å®¹è¯ å’Œ å½¢å®¹åŠ¨è¯ éƒ½å½’å…¥â€œå½¢å®¹è¯â€ä¸€æ 
                let category = null;
                if (t.pos === 'å‹•è©') category = 'å‹•è©';
                else if (t.pos === 'åè©') category = 'åè©';
                else if (t.pos === 'å½¢å®¹è©' || t.pos_detail_1 === 'å½¢å®¹å‹•è©') category = 'å½¢å®¹è©';

                if (category) {
                    // æ ¸å¿ƒè¿˜åŸé€»è¾‘ï¼šå–è¾ä¹¦å½¢ (basic_form)
                    const word = (t.basic_form && t.basic_form !== '*') ? t.basic_form : t.surface_form;
                    
                    // è¿‡æ»¤ç­–ç•¥ï¼š
                    // 1. è¿‡æ»¤æ‰åŠ©è¯æ€§è´¨çš„å•å­—åè¯ï¼ˆå¦‚ 'ã®', 'ã‚‚'ï¼‰
                    // 2. åŠ¨è¯æ’é™¤æ‰ 'ã™ã‚‹'ã€'ã„ã‚‹'ã€'ã‚ã‚‹' ç­‰è¶…é«˜é¢‘è¾…åŠ©åŠ¨è¯ï¼ˆå¯é€‰ï¼‰
                    if (word.length > 1 || /[\u4E00-\u9FFF]/.test(word)) {
                        data[category][word] = (data[category][word] || 0) + 1;
                    }
                }
            });

            // æ¸²æŸ“ä¸‰æ 
            renderSection('verbList', 'verbCount', data['å‹•è©']);
            renderSection('nounList', 'nounCount', data['åè©']);
            renderSection('adjList', 'adjCount', data['å½¢å®¹è©']);
            
            statusEl.textContent = "âœ… åˆ†æå®Œæˆï¼å…±æå– " + tokens.length + " ä¸ªç‰‡æ®µ";
        } catch (err) {
            statusEl.textContent = "âŒ å¤„ç†æ–‡ä»¶å‡ºé”™";
            console.error(err);
        }
    };

    function renderSection(listId, countId, wordMap) {
        const container = document.getElementById(listId);
        const countBadge = document.getElementById(countId);
        container.innerHTML = '';
        
        const sorted = Object.entries(wordMap).sort((a, b) => b[1] - a[1]);
        countBadge.textContent = sorted.length;
        
        sorted.forEach(([word, count]) => {
            const div = document.createElement('div');
            div.className = 'word-item';
            div.innerHTML = `
                <span class="word-text">${word}</span>
                <span class="word-count">${count} æ¬¡</span>
            `;
            container.appendChild(div);
        });
    }
</script>

</body>
</html>
