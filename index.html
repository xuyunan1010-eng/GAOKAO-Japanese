<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ—¥è¯­é«˜é¢‘è¯åˆ†ç±»æå–</title>
    <style>
        body { font-family: -apple-system, sans-serif; background: #f8fafc; padding: 20px; color: #1e293b; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .status { padding: 15px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; background: #e0f2fe; color: #0369a1; text-align: center; }
        
        /* ä¸‰ä¸ªæ¿å—çš„å¸ƒå±€ */
        .columns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px; }
        .column { background: #fff; border: 1px solid #e2e8f0; border-radius: 10px; padding: 15px; }
        .column h3 { margin-top: 0; padding-bottom: 10px; border-bottom: 2px solid #3b82f6; font-size: 16px; color: #334155; }
        
        .word-item { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid #f1f5f9; font-size: 14px; }
        .word-text { font-weight: 500; color: #2563eb; }
        .word-count { color: #94a3b8; font-size: 12px; }
        
        button { width: 100%; padding: 15px; background: #3b82f6; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
        button:disabled { background: #cbd5e1; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container">
    <div id="status" class="status">æ­£åœ¨åŠ è½½è¯å…¸...</div>
    
    <input type="file" id="fileInput" accept=".docx" hidden>
    <button id="uploadBtn" disabled>ç­‰å¾…å¼•æ“å°±ç»ª...</button>

    <div class="columns">
        <div class="column">
            <h3>ğŸ”¹ åŠ¨è¯ (è¾ä¹¦å½¢)</h3>
            <div id="verbList"></div>
        </div>
        <div class="column">
            <h3>ğŸ”¸ åè¯</h3>
            <div id="nounList"></div>
        </div>
        <div class="column">
            <h3>ğŸŒ¿ å½¢å®¹è¯</h3>
            <div id="adjList"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.21/mammoth.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js"></script>

<script>
    const statusEl = document.getElementById('status');
    const uploadBtn = document.getElementById('uploadBtn');
    let tokenizer = null;

    // åˆå§‹åŒ–å¼•æ“
    kuromoji.builder({ dicPath: "https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict/" }).build((err, _tokenizer) => {
        if (err) {
            statusEl.textContent = "âŒ å¼•æ“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
            return;
        }
        tokenizer = _tokenizer;
        statusEl.textContent = "âœ… å¼•æ“å·²å°±ç»ªï¼Œè¯·ä¸Šä¼  Word æ–‡æ¡£";
        uploadBtn.disabled = false;
        uploadBtn.textContent = "ğŸ“‚ é€‰æ‹© Word è¯•å·å¹¶åˆ†æ";
    });

    uploadBtn.onclick = () => document.getElementById('fileInput').click();

    document.getElementById('fileInput').onchange = async (e) => {
        const file = e.target.files[0];
        if (!file || !tokenizer) return;

        statusEl.textContent = "âŒ› æ­£åœ¨å¤„ç†æ–‡æ¡£...";
        const buffer = await file.arrayBuffer();
        const { value } = await mammoth.extractRawText({ arrayBuffer: buffer });
        
        // åˆ†è¯å¤„ç†
        const tokens = tokenizer.tokenize(value);
        const data = { 'å‹•è©': {}, 'åè©': {}, 'å½¢å®¹è©': {} };

        tokens.forEach(t => {
            // åªæŠ“å–æˆ‘ä»¬éœ€è¦çš„ä¸‰å¤§ç±»è¯æ€§
            if (data[t.pos]) {
                // æ ¸å¿ƒï¼šå¦‚æœæ˜¯åŠ¨è¯æˆ–å½¢å®¹è¯ï¼Œä¼˜å…ˆä½¿ç”¨è¾ä¹¦å½¢ (basic_form)
                const word = (t.basic_form && t.basic_form !== '*') ? t.basic_form : t.surface_form;
                
                // ç®€å•è¿‡æ»¤ï¼šé•¿åº¦å¤§äº1ï¼Œæˆ–è€…åŒ…å«æ±‰å­—ï¼ˆé˜²æ­¢æ”¶å½•â€œã—â€â€œã¦â€ç­‰æ— æ„ä¹‰æˆåˆ†ï¼‰
                if (word.length > 1 || /[\u4E00-\u9FFF]/.test(word)) {
                    data[t.pos][word] = (data[t.pos][word] || 0) + 1;
                }
            }
        });

        // æ¸²æŸ“åˆ°ä¸‰ä¸ªæ¿å—
        renderSection('verbList', data['å‹•è©']);
        renderSection('nounList', data['åè©']);
        renderSection('adjList', data['å½¢å®¹è©']);
        
        statusEl.textContent = "âœ… åˆ†æå®Œæˆï¼";
    };

    function renderSection(id, wordMap) {
        const container = document.getElementById(id);
        container.innerHTML = '';
        
        // æ’åºï¼šæŒ‰å‡ºç°æ¬¡æ•°ä»é«˜åˆ°ä½
        const sorted = Object.entries(wordMap).sort((a, b) => b[1] - a[1]);
        
        sorted.forEach(([word, count]) => {
            const div = document.createElement('div');
            div.className = 'word-item';
            div.innerHTML = `<span class="word-text">${word}</span><span class="word-count">${count}æ¬¡</span>`;
            container.appendChild(div);
        });
    }
</script>

</body>
</html>
