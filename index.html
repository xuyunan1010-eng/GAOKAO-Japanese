<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ—¥æœ¬èªãƒ†ã‚¹ãƒˆèªå½™é »åº¦åˆ†æãƒ„ãƒ¼ãƒ«ğŸ”</title>
    <style>
        body { font-family: "Hiragino Kaku Gothic ProN", "Microsoft YaHei", sans-serif; background: #f0f4f8; padding: 20px; color: #1e293b; }
        .container { max-width: 1100px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .header { text-align: center; margin-bottom: 25px; }
        .status { padding: 12px; border-radius: 8px; margin-bottom: 20px; font-weight: bold; background: #fff7ed; color: #c2410c; text-align: center; border: 1px solid #ffedd5; }
        .status.ready { background: #f0fdf4; color: #15803d; border-color: #bbf7d0; }

        .columns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-top: 20px; }
        .column { background: #ffffff; border: 1px solid #e2e8f0; border-radius: 12px; padding: 15px; height: 600px; display: flex; flex-direction: column; }
        .column h3 { margin-top: 0; padding-bottom: 12px; border-bottom: 3px solid #3b82f6; font-size: 18px; color: #334155; display: flex; justify-content: space-between; }
        .word-list { overflow-y: auto; flex-grow: 1; }

        .word-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 5px; border-bottom: 1px solid #f1f5f9; }
        .word-text { font-weight: 600; color: #2563eb; font-size: 15px; }
        .word-count { background: #f1f5f9; color: #64748b; font-size: 11px; padding: 2px 7px; border-radius: 10px; }

        button { width: 100%; padding: 18px; background: #3b82f6; color: white; border: none; border-radius: 10px; font-size: 17px; font-weight: bold; cursor: pointer; margin-top: 12px; }
        button:disabled { background: #cbd5e1; }

        .badge { font-size: 12px; background: #3b82f6; color: white; padding: 2px 8px; border-radius: 20px; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h2>æ—¥æœ¬èªãƒ†ã‚¹ãƒˆèªå½™é »åº¦åˆ†æãƒ„ãƒ¼ãƒ«ğŸ” </h2>
    </div>

    <div id="status" class="status">æ­£åœ¨è¯»å–æœ¬åœ°å­—å…¸ (dict/)...</div>

    <input type="file" id="fileInput" accept=".docx" hidden>
    <button id="uploadBtn" disabled>ç­‰å¾…å¼•æ“å°±ç»ª...</button>
    <button id="exportBtn" disabled>ğŸ“Š å¯¼å‡º Excel</button>

    <div class="columns">
        <div class="column">
            <h3><span>ğŸ”¹ åŠ¨è¯</span> <span id="verbCount" class="badge">0</span></h3>
            <div id="verbList" class="word-list"></div>
        </div>
        <div class="column">
            <h3><span>ğŸ”¸ åè¯</span> <span id="nounCount" class="badge">0</span></h3>
            <div id="nounList" class="word-list"></div>
        </div>
        <div class="column">
            <h3><span>ğŸŒ¿ å½¢å®¹è¯</span> <span id="adjCount" class="badge">0</span></h3>
            <div id="adjList" class="word-list"></div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/mammoth@1.4.21/mammoth.browser.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/build/kuromoji.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<script>
    const statusEl = document.getElementById('status');
    const uploadBtn = document.getElementById('uploadBtn');
    const exportBtn = document.getElementById('exportBtn');
    let tokenizer = null;
    let latestData = null;

    kuromoji.builder({ dicPath: "dict/" }).build((err, tk) => {
        if (err) {
            statusEl.textContent = "âŒ å­—å…¸åŠ è½½å¤±è´¥ï¼Œè¯·ç¡®è®¤ dict æ–‡ä»¶å¤¹å­˜åœ¨";
            return;
        }
        tokenizer = tk;
        statusEl.textContent = "âœ… æœ¬åœ°å¼•æ“å·²å°±ç»ª";
        statusEl.classList.add('ready');
        uploadBtn.disabled = false;
        uploadBtn.textContent = "é€‰æ‹© Word è¯•å·å¼€å§‹åˆ†æ";
    });

    uploadBtn.onclick = () => document.getElementById('fileInput').click();

    document.getElementById('fileInput').onchange = async e => {
        const file = e.target.files[0];
        if (!file || !tokenizer) return;

        statusEl.textContent = "âŒ› æ­£åœ¨è§£ææ–‡æ¡£...";
        const buffer = await file.arrayBuffer();
        const { value } = await mammoth.extractRawText({ arrayBuffer: buffer });

        const tokens = tokenizer.tokenize(value);
        const data = { 'åŠ¨è¯': {}, 'åè¯': {}, 'å½¢å®¹è¯': {} };

        tokens.forEach(t => {
            let cat = null;
            if (t.pos === 'å‹•è©') cat = 'åŠ¨è¯';
            else if (t.pos === 'åè©') cat = 'åè¯';
            else if (t.pos === 'å½¢å®¹è©' || t.pos_detail_1 === 'å½¢å®¹å‹•è©') cat = 'å½¢å®¹è¯';
            if (!cat) return;

            const word = t.basic_form && t.basic_form !== '*' ? t.basic_form : t.surface_form;
            if (word.length > 1 || /[\u4E00-\u9FFF]/.test(word)) {
                data[cat][word] = (data[cat][word] || 0) + 1;
            }
        });

        latestData = data;
        renderSection('verbList', 'verbCount', data['åŠ¨è¯']);
        renderSection('nounList', 'nounCount', data['åè¯']);
        renderSection('adjList', 'adjCount', data['å½¢å®¹è¯']);

        exportBtn.disabled = false;
        statusEl.textContent = "âœ… åˆ†æå®Œæˆï¼Œå¯å¯¼å‡º Excel";
    };

    function renderSection(listId, countId, map) {
        const list = document.getElementById(listId);
        const badge = document.getElementById(countId);
        list.innerHTML = '';
        const sorted = Object.entries(map).sort((a,b)=>b[1]-a[1]);
        badge.textContent = sorted.length;

        sorted.forEach(([w,c])=>{
            const div = document.createElement('div');
            div.className = 'word-item';
            div.innerHTML = `<span class="word-text">${w}</span><span class="word-count">${c} æ¬¡</span>`;
            list.appendChild(div);
        });
    }

    exportBtn.onclick = () => {
        if (!latestData) return;

        const rows = [['ä¸€çº§åˆ†ç±»','å•è¯','å‡ºç°æ¬¡æ•°']];
        for (const cat in latestData) {
            Object.entries(latestData[cat])
                .sort((a,b)=>b[1]-a[1])
                .forEach(([w,c])=>{
                    rows.push([cat, w, c]);
                });
        }

        const ws = XLSX.utils.aoa_to_sheet(rows);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'è¯é¢‘ç»Ÿè®¡');
        XLSX.writeFile(wb, 'æ—¥è¯­è¯é¢‘åˆ†ç±»ç»Ÿè®¡.xlsx');
    };
</script>

</body>
</html>
